这是一个典型的多元函数微积分综合题，主要考察两个知识点：
1.  **已知全微分求原函数**：利用偏积分法恢复函数表达式。
2.  **多元函数极值求解**：利用驻点和海森矩阵（二阶偏导数判别法）判定极值。

下面我将分步为您详细解析。

---

## 🎯 题目回顾

已知函数 $f(x,y)$：
1.  **全微分**：$df(x,y)=-2xe^{-y}dx+e^{-y}(x^{2}-y-1)dy$；
2.  **初始条件**：$f(0,0)=2$。

求：
1.  $f(x,y)$ 的表达式；
2.  $f(x,y)$ 的极值。

---

## 第一部分：求解函数 $f(x,y)$

由全微分公式 $df(x,y) = \frac{\partial f}{\partial x}dx + \frac{\partial f}{\partial y}dy$，我们可以得到偏导数方程组：

$$
\begin{cases}
\frac{\partial f}{\partial x} = -2xe^{-y} \quad \cdots\cdots ① \\
\frac{\partial f}{\partial y} = e^{-y}(x^2 - y - 1) \quad \cdots\cdots ②
\end{cases}
$$

### 1.1 对 $x$ 偏积分
由方程 ①，对 $x$ 进行积分（此时将 $y$ 视为常数）：
$$
\begin{aligned}
f(x,y) &= \int (-2xe^{-y}) dx \\
&= e^{-y} \int -2x \, dx \\
&= e^{-y}(-x^2) + \varphi(y) \\
&= -x^2e^{-y} + \varphi(y) \quad \cdots\cdots ③
\end{aligned}
$$
其中 $\varphi(y)$ 是关于 $y$ 的待定函数。

### 1.2 确定待定函数 $\varphi(y)$
对 ③ 式关于 $y$ 求偏导，并令其等于方程 ②：
$$
\frac{\partial f}{\partial y} = \frac{\partial}{\partial y}(-x^2e^{-y} + \varphi(y)) = -x^2(-e^{-y}) + \varphi'(y) = x^2e^{-y} + \varphi'(y)
$$
根据方程 ②：
$$
\frac{\partial f}{\partial y} = e^{-y}(x^2 - y - 1) = x^2e^{-y} - (y+1)e^{-y}
$$
对比两式，消去 $x^2e^{-y}$ 项，得：
$$
\varphi'(y) = -(y+1)e^{-y}
$$

对 $\varphi'(y)$ 积分求 $\varphi(y)$（使用分部积分法）：
令 $u = y+1, dv = -e^{-y}dy$，则 $du = dy, v = e^{-y}$。
$$
\begin{aligned}
\varphi(y) &= \int -(y+1)e^{-y} dy \\
&= (y+1)e^{-y} - \int e^{-y} dy \\
&= (y+1)e^{-y} - (-e^{-y}) + C \\
&= ye^{-y} + e^{-y} + e^{-y} + C \\
&= (y+2)e^{-y} + C
\end{aligned}
$$

将 $\varphi(y)$ 代回 ③ 式，得到通解：
$$
f(x,y) = -x^2e^{-y} + (y+2)e^{-y} + C = e^{-y}(y + 2 - x^2) + C
$$

### 1.3 利用初值确定常数 $C$
由条件 $f(0,0)=2$，代入上式：
$$
f(0,0) = e^{-0}(0 + 2 - 0) + C = 1 \cdot 2 + C = 2 + C
$$
令 $2 + C = 2$，解得 **$C = 0$**。

✅ **结论一：函数的表达式为**
$$
f(x,y) = e^{-y}(y + 2 - x^2)
$$

---

## 第二部分：求解 $f(x,y)$ 的极值

求解多元函数极值的标准步骤是：求驻点 $\to$ 计算二阶偏导 $\to$ 利用判别式判定。

### 2.1 求驻点
令一阶偏导数为 0：
$$
\begin{cases}
f_x = -2xe^{-y} = 0 \quad \cdots\cdots ④ \\
f_y = e^{-y}(x^2 - y - 1) = 0 \quad \cdots\cdots ⑤
\end{cases}
$$

1.  由 ④，因为 $e^{-y} \ne 0$，所以必有 **$x = 0$**。
2.  将 $x = 0$ 代入 ⑤：
    $$e^{-y}(0 - y - 1) = 0 \implies -(y+1)e^{-y} = 0$$
    解得 **$y = -1$**。

故唯一的驻点为 **$(0, -1)$**。

### 2.2 计算二阶偏导数
我们需要计算 $A=f_{xx}, B=f_{xy}, C=f_{yy}$。
已知 $f_x = -2xe^{-y}$， $f_y = x^2e^{-y} - ye^{-y} - e^{-y}$。

1.  **$f_{xx}$**：
    $$f_{xx} = \frac{\partial}{\partial x}(-2xe^{-y}) = -2e^{-y}$$

2.  **$f_{xy}$**：
    $$f_{xy} = \frac{\partial}{\partial y}(-2xe^{-y}) = -2x(-e^{-y}) = 2xe^{-y}$$

3.  **$f_{yy}$**：
    $$f_{yy} = \frac{\partial}{\partial y}[e^{-y}(x^2 - y - 1)]$$
    使用乘法求导法则（或直接展开求导）：
    $$
    \begin{aligned}
    f_{yy} &= \frac{\partial}{\partial y}(x^2e^{-y} - ye^{-y} - e^{-y}) \\
    &= x^2(-e^{-y}) - [1\cdot e^{-y} + y(-e^{-y})] - (-e^{-y}) \\
    &= -x^2e^{-y} - e^{-y} + ye^{-y} + e^{-y} \\
    &= e^{-y}(y - x^2)
    \end{aligned}
    $$

### 2.3 在驻点 $(0, -1)$ 处进行判定
将 $x=0, y=-1$ 代入上述二阶偏导数公式：

1.  $A = f_{xx}(0, -1) = -2e^{-(-1)} = -2e$
2.  $B = f_{xy}(0, -1) = 2(0)e^{1} = 0$
3.  $C = f_{yy}(0, -1) = e^{1}(-1 - 0) = -e$

计算判别式 $\Delta = AC - B^2$：
$$
\Delta = (-2e) \cdot (-e) - 0^2 = 2e^2
$$

**判定结论**：
1.  **$\Delta = 2e^2 > 0$**：说明该点是极值点。
2.  **$A = -2e < 0$**：说明该点是**极大值**点。

### 2.4 计算极值
极大值为 $f(0, -1)$：
$$
\begin{aligned}
f(0, -1) &= e^{-(-1)}(-1 + 2 - 0^2) \\
&= e^{1} \cdot 1 \\
&= e
\end{aligned}
$$

---

## ✅ 最终答案

1.  函数表达式为：
    $$
    f(x,y) = e^{-y}(y + 2 - x^2)
    $$
2.  函数在点 $(0, -1)$ 处取得极大值，极大值为 **$e$**。