这是一个关于矩阵合同（Congruence）与正交相似（Orthogonal Similarity）的线性代数综合题。

### (1) 求 $k$ 的值及 $a$ 的取值范围

**1. 分析矩阵的秩**
矩阵 $A$ 与 $B$ 合同，意味着它们具有相同的秩（Rank）。
对于矩阵 $B$：
$$B=\begin{pmatrix}k&0&0\\ 0&6&0\\ 0&0&0\end{pmatrix}$$
由于 $B$ 有一列全为 $0$，其秩 $\text{r}(B) \le 2$。
若 $k=0$，$\text{r}(B)=1$；若 $k \ne 0$，$\text{r}(B)=2$。

对于矩阵 $A$：
$$A=\begin{pmatrix}4&1&-2\\ 1&1&1\\ -2&1&a\end{pmatrix}$$
我们可以计算 $A$ 的二阶子式，例如左上角的二阶子式：
$$\begin{vmatrix} 4 & 1 \\ 1 & 1 \end{vmatrix} = 4 - 1 = 3 \ne 0$$
说明 $\text{r}(A) \ge 2$。

因为 $A$ 与 $B$ 合同，所以 $\text{r}(A) = \text{r}(B)$。
结合 $\text{r}(A) \ge 2$ 和 $\text{r}(B) \le 2$，必定有 $\text{r}(A) = \text{r}(B) = 2$。

**2. 求解 $a$**
由于 $\text{r}(A)=2$，矩阵 $A$ 的行列式必须为 $0$：
$$
\begin{aligned}
|A| &= 4(a-1) - 1(a+2) + (-2)(1+2) \\
&= 4a - 4 - a - 2 - 6 \\
&= 3a - 12
\end{aligned}
$$
令 $|A|=0$，解得 $3a-12=0$，即 **$a=4$**。

**3. 求解 $k$**
由于 $\text{r}(B)=2$，对角线元素 $k$ 不能为 $0$，即 $k \ne 0$。
此外，合同矩阵具有相同的正惯性指数（正特征值的个数）。
当 $a=4$ 时，我们求 $A$ 的特征值或通过配方法求其正惯性指数。
对 $A$ 进行初等行变换或配方：
$$f(x) = 4x_1^2 + x_2^2 + 4x_3^2 + 2x_1x_2 - 4x_1x_3 + 2x_2x_3$$
利用顺序主子式判断：
$D_1 = 4 > 0$
$D_2 = 3 > 0$
$D_3 = |A| = 0$
根据惯性定理，正主子式序列为正、正、零，说明 $A$ 是半正定的，且秩为2。这意味着 $A$ 有两个正特征值和一个零特征值。
即 $A$ 的正惯性指数为 $2$。

矩阵 $B$ 的特征值（即对角线元素）为 $k, 6, 0$。
要使 $B$ 的正惯性指数也为 $2$，除了正数 $6$ 以外，$k$ 必须为正数。
所以，**$k > 0$**。

**结论 (1)：**
$a=4$， $k > 0$。

---

### (2) 若存在正交矩阵 $Q$ 使得 $Q^{T}AQ=B$，求 $k$ 及 $Q$

**1. 分析条件**
条件 $Q^{T}AQ=B$ 且 $Q$ 为正交矩阵（即 $Q^T = Q^{-1}$），等价于 $Q^{-1}AQ=B$。
这说明矩阵 $A$ 与 $B$ **相似**。
相似矩阵具有相同的特征值。

**2. 确定 $k$ 的值**
由 (1) 知 $a=4$，此时 $A=\begin{pmatrix}4&1&-2\\ 1&1&1\\ -2&1&4\end{pmatrix}$。
求 $A$ 的特征值，计算特征多项式 $|\lambda E - A|$：
$$
\begin{aligned}
|\lambda E - A| &= \begin{vmatrix} \lambda-4 & -1 & 2 \\ -1 & \lambda-1 & -1 \\ 2 & -1 & \lambda-4 \end{vmatrix} \\
&\xrightarrow{c_3+c_1} \begin{vmatrix} \lambda-4 & -1 & \lambda-2 \\ -1 & \lambda-1 & -2 \\ 2 & -1 & \lambda-2 \end{vmatrix} \\
&\xrightarrow{r_1-r_3} \begin{vmatrix} \lambda-6 & 0 & 0 \\ -1 & \lambda-1 & -2 \\ 2 & -1 & \lambda-2 \end{vmatrix} \\
&= (\lambda-6) [(\lambda-1)(\lambda-2) - 2] \\
&= (\lambda-6) (\lambda^2 - 3\lambda) \\
&= \lambda(\lambda-3)(\lambda-6)
\end{aligned}
$$
$A$ 的特征值为 $6, 3, 0$。
$B$ 的特征值为 $6, k, 0$。
由相似性可知特征值集合相等，故 **$k=3$**。

**3. 求正交矩阵 $Q$**
$Q$ 的列向量即为 $A$ 对应于特征值 $3, 6, 0$ 的单位特征向量。
注意 $B=\begin{pmatrix}3&0&0\\ 0&6&0\\ 0&0&0\end{pmatrix}$，所以 $Q$ 的第一列对应 $\lambda=3$，第二列对应 $\lambda=6$，第三列对应 $\lambda=0$。

* **当 $\lambda_1 = 3$ 时**，解方程 $(3E-A)x=0$：
    $$\begin{pmatrix} -1 & -1 & 2 \\ -1 & 2 & -1 \\ 2 & -1 & -1 \end{pmatrix} \xrightarrow{\text{化简}} \begin{pmatrix} 1 & 0 & -1 \\ 0 & 1 & -1 \\ 0 & 0 & 0 \end{pmatrix}$$
    基础解系为 $\xi_1 = (1, 1, 1)^T$。
    单位化：$\eta_1 = \frac{1}{\sqrt{3}}(1, 1, 1)^T$。

* **当 $\lambda_2 = 6$ 时**，解方程 $(6E-A)x=0$：
    $$\begin{pmatrix} 2 & -1 & 2 \\ -1 & 5 & -1 \\ 2 & -1 & 2 \end{pmatrix} \xrightarrow{\text{化简}} \begin{pmatrix} 1 & 0 & 1 \\ 0 & 1 & 0 \\ 0 & 0 & 0 \end{pmatrix}$$
    基础解系为 $\xi_2 = (-1, 0, 1)^T$。
    单位化：$\eta_2 = \frac{1}{\sqrt{2}}(-1, 0, 1)^T$。

* **当 $\lambda_3 = 0$ 时**，解方程 $Ax=0$：
    $$\begin{pmatrix} 4 & 1 & -2 \\ 1 & 1 & 1 \\ -2 & 1 & 4 \end{pmatrix} \xrightarrow{\text{化简}} \begin{pmatrix} 1 & 0 & -1 \\ 0 & 1 & 2 \\ 0 & 0 & 0 \end{pmatrix}$$
    基础解系为 $\xi_3 = (1, -2, 1)^T$。
    单位化：$\eta_3 = \frac{1}{\sqrt{6}}(1, -2, 1)^T$。

**结论 (2)：**
$k=3$，正交矩阵 $Q$ 为：
$$Q = (\eta_1, \eta_2, \eta_3) = \begin{pmatrix} \frac{1}{\sqrt{3}} & -\frac{1}{\sqrt{2}} & \frac{1}{\sqrt{6}} \\ \frac{1}{\sqrt{3}} & 0 & -\frac{2}{\sqrt{6}} \\ \frac{1}{\sqrt{3}} & \frac{1}{\sqrt{2}} & \frac{1}{\sqrt{6}} \end{pmatrix}$$