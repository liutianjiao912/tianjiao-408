## 🎯 题目回顾

**2.** 函数 $f(x)=\begin{cases}\frac{1}{\sqrt{1+x^{2}}},&x\le0,\\ (x+1)\cos x,&x>0\end{cases}$ 的一个原函数为（ ）。

(A) $F(x)=\begin{cases}\ln(\sqrt{1+x^{2}}-x),&x\le0\\ (x+1)\cos x-\sin x,&x>0\end{cases}$

(B) $F(x)=\begin{cases}\ln(\sqrt{1+x^{2}}-x)+1,&x\le0\\ (x+1)\cos x-\sin x,&x>0\end{cases}$

(C) $F(x)=\begin{cases}\ln(\sqrt{1+x^{2}}+x),&x\le0\\ (x+1)\sin x+\cos x,&x>0\end{cases}$

(D) $F(x)=\begin{cases}\ln(\sqrt{1+x^{2}}+x)+1,&x\le0\\ (x+1)\sin x+\cos x,&x>0\end{cases}$

---

## 第一部分：解题核心思路

### 1.1 原函数的定义与性质

若 $F(x)$ 是 $f(x)$ 的原函数，则必须满足以下两个条件：
1.  **导数关系**：在 $f(x)$ 的定义域内，$F'(x) = f(x)$。
2.  **连续性**：由于原函数 $F(x)$ 是可导的（因为 $F'(x)$ 存在），根据“可导必连续”，**$F(x)$ 必须在整个定义域（包括分段点 $x=0$）上连续**。

因此，我们的解题策略是：
1.  分别求出 $x \le 0$ 和 $x > 0$ 时的不定积分；
2.  利用 $x=0$ 处的**连续性**确定两个分段部分常数项之间的关系；
3.  筛选选项。

---

## 第二部分：分段积分计算

### 2.1 计算左段积分 ($x \le 0$)

对于 $x \le 0$，函数为 $f(x) = \frac{1}{\sqrt{1+x^2}}$。
这是一个基本的积分公式：
$$
\int \frac{1}{\sqrt{1+x^2}} dx = \ln(x + \sqrt{1+x^2}) + C_1
$$

**排除法分析**：
观察选项 (A) 和 (B)，它们给出的左侧函数是 $\ln(\sqrt{1+x^2}-x)$。
我们求导验证一下：
$$
[\ln(\sqrt{1+x^2}-x)]' = \frac{1}{\sqrt{1+x^2}-x} \cdot (\frac{x}{\sqrt{1+x^2}} - 1) = \frac{1}{\sqrt{1+x^2}-x} \cdot \frac{x-\sqrt{1+x^2}}{\sqrt{1+x^2}} = -\frac{1}{\sqrt{1+x^2}}
$$
结果为负，与 $f(x)$ 不符。
❌ **因此，排除选项 (A) 和 (B)。答案只能在 (C) 或 (D) 中。**

### 2.2 计算右段积分 ($x > 0$)

对于 $x > 0$，函数为 $f(x) = (x+1)\cos x$。
采用**分部积分法**。设 $u = x+1$，$dv = \cos x dx$，则 $du = dx$，$v = \sin x$。

$$
\begin{aligned}
\int (x+1)\cos x dx &= (x+1)\sin x - \int \sin x dx \\
&= (x+1)\sin x - (-\cos x) + C_2 \\
&= (x+1)\sin x + \cos x + C_2
\end{aligned}
$$

**验证选项**：
选项 (C) 和 (D) 的右侧部分均为 $(x+1)\sin x + \cos x$，形式正确。

---

## 第三部分：利用连续性确定常数

### 3.1 构造通解

综合上述积分结果，原函数 $F(x)$ 的一般形式为：
$$
F(x) = 
\begin{cases}
\ln(x + \sqrt{1+x^2}) + C_1, & x \le 0 \\
(x+1)\sin x + \cos x + C_2, & x > 0
\end{cases}
$$

### 3.2 连续性条件

为了使 $F(x)$ 在 $x=0$ 处连续，必须满足左极限等于右极限（等于函数值）：
$$
\lim_{x \to 0^-} F(x) = \lim_{x \to 0^+} F(x) = F(0)
$$

**计算左极限** ($x \to 0^-$)：
$$
\lim_{x \to 0} \left[ \ln(x + \sqrt{1+x^2}) + C_1 \right] = \ln(0 + \sqrt{1}) + C_1 = \ln 1 + C_1 = 0 + C_1 = C_1
$$

**计算右极限** ($x \to 0^+$)：
$$
\lim_{x \to 0} \left[ (x+1)\sin x + \cos x + C_2 \right] = (0+1)\cdot 0 + 1 + C_2 = 1 + C_2
$$

**建立方程**：
$$
C_1 = 1 + C_2
$$

---

## 第四部分：选项比对与最终结论

我们要寻找满足 $C_1 = 1 + C_2$ 的选项。

* **选项 (C)**：
    * 左边是 $\ln(\sqrt{1+x^2}+x)$，意味着 $C_1 = 0$。
    * 右边是 $(x+1)\sin x + \cos x$，意味着 $C_2 = 0$。
    * 检验：$0 = 1 + 0$ ？ ❌ **不成立，该函数在 $x=0$ 处不连续**。

* **选项 (D)**：
    * 左边是 $\ln(\sqrt{1+x^2}+x) + \mathbf{1}$，意味着 $C_1 = 1$。
    * 右边是 $(x+1)\sin x + \cos x$，意味着 $C_2 = 0$。
    * 检验：$1 = 1 + 0$ ？ ✅ **成立，该函数在 $x=0$ 处连续**。

---

## ✅ 最终答案：**(D)**

---

## 📌 关键要点总结

1.  **原函数必连续**：这是一个极其重要的隐含条件。分段函数的原函数问题，最后一步永远是检查分段点处的连续性（左极限=右极限）。
2.  **基本积分公式熟练度**：必须迅速识别 $\int \frac{1}{\sqrt{1+x^2}}dx = \ln(x+\sqrt{1+x^2}) + C$。
3.  **分部积分法**：处理“多项式 $\times$ 三角函数”的标准手段。
4.  **常数匹配**：原函数不是唯一的，可以差一个常数，但在分段函数中，分段两侧的常数 $C_1, C_2$ 是相互制约的。