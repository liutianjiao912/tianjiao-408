## 🎯 问题回顾

**解答题**：
已知函数 $z=z(x,y)$ 由方程 $(x^{2}+y^{2})z+\ln z+2(x+y+1)=0$ 确定，求 $z=z(x,y)$ 的极值.

---

## 第一部分：求驻点

### 1.1 隐函数求导公式

设 $F(x, y, z) = (x^2+y^2)z + \ln z + 2(x+y+1) = 0$.
根据隐函数求导法则，有：
$$
\frac{\partial z}{\partial x} = -\frac{F_x}{F_z}, \quad \frac{\partial z}{\partial y} = -\frac{F_y}{F_z}
$$

**极值的必要条件**是 $z_x = 0$ 且 $z_y = 0$.
这等价于 $F_x = 0$ 且 $F_y = 0$ （前提是 $F_z \ne 0$）.

### 1.2 计算偏导数 $F_x, F_y$

对 $F(x, y, z)$ 分别求偏导：
$$
F_x = \frac{\partial}{\partial x} \left[ (x^2+y^2)z + \ln z + 2x + 2y + 2 \right] = 2xz + 2
$$
$$
F_y = \frac{\partial}{\partial y} \left[ (x^2+y^2)z + \ln z + 2x + 2y + 2 \right] = 2yz + 2
$$

### 1.3 求解驻点坐标 $(x, y)$

令 $F_x = 0$ 和 $F_y = 0$：
$$
\begin{cases}
2xz + 2 = 0 \implies xz = -1 \\
2yz + 2 = 0 \implies yz = -1
\end{cases}
$$

由上式可知 $z \ne 0$（否则 $0=-1$ 矛盾，且原方程中有 $\ln z$，故 $z>0$）。
消去 $z$，得 $x = y = -\frac{1}{z}$.

将 $x = -\frac{1}{z}, y = -\frac{1}{z}$ 代入原方程 $F(x, y, z) = 0$ 中求解 $z$：

$$
\left[ \left(-\frac{1}{z}\right)^2 + \left(-\frac{1}{z}\right)^2 \right] z + \ln z + 2\left(-\frac{1}{z} - \frac{1}{z} + 1\right) = 0
$$

化简：
$$
\left( \frac{2}{z^2} \right) z + \ln z + 2\left( 1 - \frac{2}{z} \right) = 0
$$
$$
\frac{2}{z} + \ln z + 2 - \frac{4}{z} = 0
$$
$$
\ln z + 2 - \frac{2}{z} = 0
$$

设辅助函数 $g(z) = \ln z + 2 - \frac{2}{z}$ ($z>0$)。
观察可知，当 $z=1$ 时：
$$
g(1) = \ln 1 + 2 - 2 = 0
$$
显然 $z=1$ 是方程的根。
(注：$g'(z) = \frac{1}{z} + \frac{2}{z^2} > 0$，故函数单调递增，根唯一)。

### 1.4 确定唯一的驻点

当 $z=1$ 时：
$$
x = -\frac{1}{1} = -1, \quad y = -\frac{1}{1} = -1
$$
故唯一的驻点为 **$(-1, -1)$**，对应的函数值为 **$z = 1$**。

---

## 第二部分：判断极值类型（充分条件）

### 2.1 计算二阶偏导数

利用隐函数二阶导数公式，或者直接对 $F_x + F_z \cdot z_x = 0$ 两边继续求导。
在驻点处，已知 $z_x = 0, z_y = 0$。

对 $2xz + 2 + F_z \cdot z_x = 0$ 关于 $x$ 求导：
$$
2z + 2x z_x + (F_{zx} z_x + F_{zz} z_x^2 + F_z z_{xx}) = 0
$$
代入驻点条件 $z_x = 0$，$z=1, x=-1$：
$$
2(1) + 0 + F_z \cdot z_{xx} = 0 \implies z_{xx} = -\frac{2}{F_z}
$$
同理，利用对称性或对 $y$ 求导：
$$
z_{yy} = -\frac{2}{F_z}
$$
对 $2xz + 2 + F_z \cdot z_x = 0$ 关于 $y$ 求导：
$$
0 + 2x z_y + (F_{zy} z_x + F_{zz} z_x z_y + F_z z_{xy}) = 0
$$
代入驻点条件 $z_x=0, z_y=0$：
$$
F_z \cdot z_{xy} = 0 \implies z_{xy} = 0
$$

### 2.2 计算 $F_z$ 的值

$$
F_z = \frac{\partial}{\partial z} \left[ (x^2+y^2)z + \ln z + \dots \right] = x^2 + y^2 + \frac{1}{z}
$$
在驻点 $(-1, -1)$ 处，$z=1$：
$$
F_z = (-1)^2 + (-1)^2 + \frac{1}{1} = 1 + 1 + 1 = 3
$$

### 2.3 计算 $A, B, C$

$$
A = z_{xx} = -\frac{2}{F_z} = -\frac{2}{3}
$$
$$
B = z_{xy} = 0
$$
$$
C = z_{yy} = -\frac{2}{F_z} = -\frac{2}{3}
$$

### 2.4 判别式判定

$$
AC - B^2 = \left(-\frac{2}{3}\right)\left(-\frac{2}{3}\right) - 0^2 = \frac{4}{9} > 0
$$
且 $A = -\frac{2}{3} < 0$.

根据极值判别法：
* $AC - B^2 > 0$ 且 $A < 0$，则函数取得**极大值**。

---

## ✅ 最终答案

函数 $z=z(x,y)$ 在点 $(-1, -1)$ 处取得极大值，极大值为 **$1$**.

---

## 📌 关键要点总结

1.  **隐函数极值必要条件**：直接令 $F_x=0, F_y=0$ 求解 $x,y,z$ 的关系，再代回原方程定值。
2.  **简化计算二阶导**：在驻点处（$z_x=0, z_y=0$），隐函数的二阶导数公式会大幅简化。
    * $z_{xx} = -\frac{F_{xx}}{F_z}$
    * $z_{xy} = -\frac{F_{xy}}{F_z}$
    * $z_{yy} = -\frac{F_{yy}}{F_z}$
    *(注：本题中 $F_{xx}=2z, F_{xy}=0, F_{yy}=2z$，直接代入即得 $A, B, C$)*
3.  **定义域隐含条件**：方程中含有 $\ln z$，暗示 $z>0$，这有助于排除无效解或确定参数符号。