这是一道典型的**二重积分**计算题，解题的关键在于正确分析积分区域 $D$ 的形状，并选择合适的坐标系（本题利用**极坐标变换**最为简便）。

下面是详细的解析步骤。

---

## 🎯 题目回顾

计算二重积分：
$$
I = \iint_{D} \frac{(x-y)^{2}}{x^{2}+y^{2}} \, dxdy
$$
其中区域 $D$ 由不等式确定：
$$
D = \{(x,y) \mid y-2 \le x \le \sqrt{4-y^{2}}, \quad 0 \le y \le 2\}
$$

---

## 第一部分：区域分析与作图

首先分析区域 $D$ 的边界：
1.  **右边界**：$x \le \sqrt{4-y^2}$。
    即 $x^2 + y^2 \le 4$ 且 $x \ge 0$（由根号性质）。这是一个半径为 2 的圆在第一象限的部分。
2.  **左边界**：$x \ge y-2$。
    即 $x - y + 2 \ge 0$，对应的边界线为 $x - y = -2$，通过点 $(-2, 0)$ 和 $(0, 2)$。
3.  **上下边界**：$0 \le y \le 2$。
    这限制了区域在 $x$ 轴上方。

**区域形状**：
区域 $D$ 是以原点为中心、半径为 2 的上半圆盘，但被直线 $x = y-2$ 切去了一部分（实际上是切去了第二象限中直线左上方的部分，保留了直线与 $y$ 轴之间的部分）。
- 在第一象限 ($x>0$)，区域由圆弧 $x^2+y^2=4$ 围成。
- 在第二象限 ($x<0$)，区域由直线 $x=y-2$ 围成。
- 整个区域的底边在 $x$ 轴上，从 $x=-2$ 到 $x=2$。

---

## 第二部分：极坐标变换

由于被积函数含有 $x^2+y^2$ 项，且区域涉及圆形边界，使用极坐标变换是最佳选择。

### 2.1 坐标变换公式
令：
$$
\begin{cases}
x = r\cos\theta \\
y = r\sin\theta
\end{cases}
$$
面积元素为 $dxdy = r \, dr d\theta$。

### 2.2 被积函数化简
$$
\begin{aligned}
\frac{(x-y)^{2}}{x^{2}+y^{2}} &= \frac{x^{2} - 2xy + y^{2}}{x^{2}+y^{2}} \\
&= \frac{x^{2}+y^{2}}{x^{2}+y^{2}} - \frac{2xy}{x^{2}+y^{2}} \\
&= 1 - \frac{2(r\cos\theta)(r\sin\theta)}{r^2} \\
&= 1 - 2\cos\theta\sin\theta \\
&= 1 - \sin(2\theta)
\end{aligned}
$$

### 2.3 确定新的积分限
区域 $D$ 横跨第一和第二象限，极角 $\theta$ 的范围是 $0$ 到 $\pi$。我们需要将区域分为两部分讨论：

1.  **第一部分 $D_1$（第一象限）**：
    - 角度范围：$0 \le \theta \le \frac{\pi}{2}$。
    - 径向范围：射线从原点出发，终止于圆周 $x^2+y^2=4$，即 $r=2$。
    - 限制：$0 \le r \le 2$。

2.  **第二部分 $D_2$（第二象限）**：
    - 角度范围：$\frac{\pi}{2} \le \theta \le \pi$。
    - 径向范围：射线从原点出发，终止于直线 $x = y - 2$。
    - 将直线方程转化为极坐标：
      $$r\cos\theta = r\sin\theta - 2 \implies r(\sin\theta - \cos\theta) = 2$$
      即：
      $$r = \frac{2}{\sin\theta - \cos\theta}$$
    - 限制：$0 \le r \le \frac{2}{\sin\theta - \cos\theta}$。

---

## 第三部分：计算积分

总积分 $I = I_1 + I_2$。

### 3.1 计算 $I_1$ (第一象限部分)

$$
\begin{aligned}
I_1 &= \int_{0}^{\frac{\pi}{2}} d\theta \int_{0}^{2} (1 - \sin(2\theta)) \cdot r \, dr \\
&= \int_{0}^{\frac{\pi}{2}} (1 - \sin(2\theta)) \cdot \left[ \frac{1}{2}r^2 \right]_{0}^{2} \, d\theta \\
&= \int_{0}^{\frac{\pi}{2}} (1 - \sin(2\theta)) \cdot 2 \, d\theta \\
&= 2 \left[ \theta + \frac{1}{2}\cos(2\theta) \right]_{0}^{\frac{\pi}{2}} \\
&= 2 \left[ \left(\frac{\pi}{2} + \frac{1}{2}\cos\pi\right) - \left(0 + \frac{1}{2}\cos0\right) \right] \\
&= 2 \left[ \left(\frac{\pi}{2} - \frac{1}{2}\right) - \frac{1}{2} \right] \\
&= 2 \left( \frac{\pi}{2} - 1 \right) \\
&= \pi - 2
\end{aligned}
$$

### 3.2 计算 $I_2$ (第二象限部分)

$$
\begin{aligned}
I_2 &= \int_{\frac{\pi}{2}}^{\pi} d\theta \int_{0}^{\frac{2}{\sin\theta - \cos\theta}} (1 - \sin(2\theta)) \cdot r \, dr \\
&= \int_{\frac{\pi}{2}}^{\pi} (1 - \sin(2\theta)) \cdot \left[ \frac{1}{2}r^2 \right]_{0}^{\frac{2}{\sin\theta - \cos\theta}} \, d\theta \\
&= \int_{\frac{\pi}{2}}^{\pi} (1 - \sin(2\theta)) \cdot \frac{1}{2} \cdot \left( \frac{2}{\sin\theta - \cos\theta} \right)^2 \, d\theta \\
&= \int_{\frac{\pi}{2}}^{\pi} (1 - \sin(2\theta)) \cdot \frac{2}{(\sin\theta - \cos\theta)^2} \, d\theta
\end{aligned}
$$

**关键化简**：
观察分母 $(\sin\theta - \cos\theta)^2$：
$$
(\sin\theta - \cos\theta)^2 = \sin^2\theta - 2\sin\theta\cos\theta + \cos^2\theta = 1 - \sin(2\theta)
$$

代入积分式中，分子分母完美抵消：
$$
\begin{aligned}
I_2 &= \int_{\frac{\pi}{2}}^{\pi} (1 - \sin(2\theta)) \cdot \frac{2}{1 - \sin(2\theta)} \, d\theta \\
&= \int_{\frac{\pi}{2}}^{\pi} 2 \, d\theta \\
&= 2 \left( \pi - \frac{\pi}{2} \right) \\
&= \pi
\end{aligned}
$$

---

## 第四部分：总结与结果

将两部分结果相加：
$$
\begin{aligned}
I &= I_1 + I_2 \\
&= (\pi - 2) + \pi \\
&= 2\pi - 2
\end{aligned}
$$

✅ **最终答案：**
$$
\iint_{D}\frac{(x-y)^{2}}{x^{2}+y^{2}}dxdy = 2\pi - 2
$$